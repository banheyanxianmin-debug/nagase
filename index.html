<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>長瀬・八戸ノ里 発車時刻</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" type="image/png" sizes="32x32" href="icon-512.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icon-512.png">
  <link rel="manifest" href="manifest.json">

  <style>
    body {
        background-color: #000;
        color: #FFF;
        /* フォントをシステム標準のゴシック体で統一し、簡潔に */
        font-family: "Helvetica Neue", "Arial", "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Meiryo", "BIZ UDPGothic", "sans-serif";
        margin: 0;
        padding: 0;
        font-size: 16px;
        font-weight: normal;
        /* ページ全体の中央寄せのために最小幅を指定 */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }
    .board {
        /* ★修正: PC/スマホの幅を統一。最大600px、画面が小さい場合は98%を使用 */
        width: min(98%, 600px); 
        margin: 15px auto; 
        padding: 15px; 
        border: 4px solid #444; 
        box-shadow: 0 0 15px rgba(0,255,0,0.7); 
        background-color: #000;
        /* スマホで縦長になったときのために、flexを解除してスクロール可能に */
        min-height: auto; 
    }
    .section-title {
        /* フォントサイズをvw（viewport width）ベースにすることでスマホでも適切に表示 */
        font-size: max(1.5em, 5vw); 
        color: #66FF66;
        text-align: center;
        margin: 20px 0 10px; 
        padding: 8px 0;
        border-bottom: 1px solid #222; 
        text-shadow: 0 0 8px #66FF66;
        font-weight: normal; 
    }
    .line {
        display: flex;
        justify-content: space-between;
        align-items: center; 
        /* フォントサイズをvwベースにし、画面サイズに合わせて調整 */
        font-size: max(1.1em, 3.8vw); 
        padding: 8px 0; 
        border-top: 1px dashed #444; 
        white-space: nowrap;
        min-height: 2.5em; /* 行の高さを少し上げて見やすく */
    }
    .line:last-of-type {
        border-bottom: 1px solid #444; 
    }
    
    /* レイアウト調整 */
    .label {
        flex-basis: auto;
        flex-grow: 1; 
        display: flex; 
        align-items: center; 
        min-width: 0; 
        /* 行の高さの中央に揃えるために、flex-directionをrowに明示 */
        flex-direction: row; 
    }
    
    .label .prefix {
        flex-shrink: 0; 
        padding-right: 8px; /* スペースを少し広げて見やすく */
        color: #88FF88;
        font-size: 0.7em; /* 小さくして目立たなく */
    }
    
    .label .destination-container {
        flex-grow: 1; 
        text-align: left; /* 行き先を左寄せにし、prefixと自然に繋げる */
        min-width: 0; 
        overflow: hidden; 
        text-overflow: ellipsis; /* 長すぎる行き先は...で省略 */
        white-space: nowrap;
        padding-left: 5px;
    }
    
    .time {
        /* 発車時刻の縦揃えのため、固定幅と等幅フォントを維持 */
        flex-basis: 90px; /* 少し幅を広げて見やすく */
        flex-shrink: 0;
        text-align: center; 
        color: #FFFF66;
        font-weight: bold;
        /* 等幅フォントを維持 */
        font-family: 'Consolas', 'Courier New', monospace; 
    }
    .countdown {
        flex-basis: 30%; /* 割合で指定 */
        flex-shrink: 0;
        min-width: 100px; /* 最小幅を確保 */
        text-align: right;
        color: #FFAA00;
        font-weight: normal; 
        font-size: 0.7em; 
        padding-left: 5px;
    }
    
    .small {
        font-size: max(14px, 3vw); 
        color: #AAAAAA;
        text-align: center;
        margin-top: 5px;
        font-weight: normal; 
    }
    .current {
        font-size: max(1.8em, 5vw); 
        font-weight: bold;
        margin: 15px 0 5px;
        text-align: center;
        color: #66CCFF;
        text-shadow: 0 0 10px rgba(102, 204, 255, 0.5);
        white-space: nowrap;
    }
    .current .time-value {
        font-size: 1.2em; /* 時刻部分のサイズを調整 */
        margin-left: 5px;
        font-family: 'Consolas', 'Courier New', monospace; 
    }
    .train-type {
        background-color: #3333FF; /* 青を濃くしてコントラストを上げる */
        color: white;
        padding: 2px 5px; 
        border-radius: 4px; 
        font-size: 0.9em; 
        font-weight: bold; /* 少し強調 */
        line-height: 1; /* 行の高さを調整 */
        margin-right: 5px;
    }
    .destination {
        color: white;
        font-weight: bold; /* 行き先を強調 */
    }
    .delay {
        text-align: center;
        font-size: max(1.2em, 4vw); 
        color: red;
        margin-top: 20px;
        text-shadow: 0 0 8px yellow;
        display: none;
        font-weight: normal; 
    }
    .delay button {
        background-color: red;
        color: white;
        font-size: 0.9em;
        padding: 6px 15px; 
        border-radius: 6px; 
        border: none;
        cursor: pointer;
        margin-top: 10px;
        font-weight: normal;
    }
  </style>
</head>
<body>
  <div class="board">
    <div class="current">現在時刻：<span class="time-value" id="currentTime">--:--:--</span></div>
    <div class="small" id="dayLabel">平日ダイヤ／休日ダイヤ</div>
    <div class="small">※祝日は正しく機能しない場合があります。</div>

    <div class="section-title">長瀬駅（上り）鶴橋方面</div>
    <div class="line">
      <div class="label">
        <span class="prefix">先発　<span class="train-type">普通</span></span>
        <span class="destination-container"><span class="destination" id="nagaseNextDestination">大阪上本町</span></span>
      </div>
      <div class="time" id="nagaseNextTime">--:--</div>
      <div class="countdown" id="nagaseNextCountdown">あと -- 分 -- 秒</div>
    </div>
    <div class="line">
      <div class="label">
        <span class="prefix">次発　<span class="train-type">普通</span></span>
        <span class="destination-container"><span class="destination" id="nagaseSecondDestination">大阪上本町</span></span>
      </div>
      <div class="time" id="nagaseSecondTime">--:--</div>
      <div class="countdown" id="nagaseSecondCountdown">あと -- 分 -- 秒</div>
    </div>

    <div class="section-title">八戸ノ里駅（上り）鶴橋方面</div>
    <div class="line">
      <div class="label">
        <span class="prefix">先発　<span class="train-type">普通</span></span>
        <span class="destination-container"><span class="destination" id="hachinoNextDestination">--</span></span>
      </div>
      <div class="time" id="hachinoNextTime">--:--</div>
      <div class="countdown" id="hachinoNextCountdown">あと -- 分 -- 秒</div>
    </div>
    <div class="line">
      <div class="label">
        <span class="prefix">次発　<span class="train-type">普通</span></span>
        <span class="destination-container"><span class="destination" id="hachinoSecondDestination">--</span></span>
      </div>
      <div class="time" id="hachinoSecondTime">--:--</div>
      <div class="countdown" id="hachinoSecondCountdown">あと -- 分 -- 秒</div>
    </div>

    <div class="section-title">八戸ノ里駅（下り）奈良方面</div>
    <div class="line">
      <div class="label">
        <span class="prefix">先発　<span class="train-type">普通</span></span>
        <span class="destination-container"><span class="destination" id="hachinoDownNextDestination">--</span></span>
      </div>
      <div class="time" id="hachinoDownNextTime">--:--</div>
      <div class="countdown" id="hachinoDownNextCountdown">あと -- 分 -- 秒</div>
    </div>
    <div class="line">
      <div class="label">
        <span class="prefix">次発　<span class="train-type">普通</span></span>
        <span class="destination-container"><span class="destination" id="hachinoDownSecondDestination">--</span></span>
      </div>
      <div class="time" id="hachinoDownSecondTime">--:--</div>
      <div class="countdown" id="hachinoDownSecondCountdown">あと -- 分 -- 秒</div>
    </div>

    <div class="delay" id="delayInfo">
      ⚠ 遅延情報あり ⚠
      <br>
      <a href="https://www.kintetsu.jp/unkou/unkou.html" target="_blank">
        <button>近鉄運行情報を見る</button>
      </a>
    </div>
  </div>

  <script>
    // 長瀬 上り (時刻データは変更なし)
    const weekdayTimesNagase = [ "05:17","05:34","05:50","06:08","06:24","06:33","06:46","06:59",
      "07:15","07:32","07:46","07:55","08:10","08:21","08:35","08:48",
      "09:01","09:11","09:21","09:29","09:37","09:50","10:01","10:15",
      "10:27","10:33","10:44","11:00","11:07","11:19","11:32","11:46","11:58",
      "12:08","12:24","12:34","12:46","13:00","13:08","13:24","13:34","13:46",
      "14:00","14:07","14:24","14:34","14:46","15:01","15:07","15:19","15:25",
      "15:34","15:46","16:01","16:08","16:25","16:34","16:43","16:47","16:52",
      "17:00","17:09","17:17","17:27","17:39","17:51","18:02","18:15","18:22",
      "18:31","18:36","18:42","18:53","19:07","19:19","19:31","19:44","19:58",
      "20:03","20:17","20:30","20:42","20:59","21:08","21:19","21:29","21:42",
      "21:50","22:05","22:16","22:33","22:47","23:02","23:10","23:26","23:39","23:50"
    ];
    const holidayTimesNagase = [ "05:17","05:34","05:52","06:08","06:27","06:44","06:57",
      "07:13","07:30","07:39","07:52","08:07","08:15","08:28","08:37",
      "08:49","09:04","09:16","09:27","09:38","09:50","10:07","10:17",
      "10:30","10:46","11:03","11:18","11:34","11:47","12:00","12:09",
      "12:24","12:34","12:46","13:00","13:07","13:24","13:34","13:48",
      "14:00","14:07","14:24","14:34","14:46","15:00","15:07","15:24",
      "15:34","15:46","16:00","16:07","16:24","16:34","16:49","17:03",
      "17:11","17:24","17:31","17:45","17:59","18:09","18:19","18:32",
      "18:46","18:58","19:11","19:18","19:35","19:43","19:52","20:02",
      "20:16","20:32","20:40","20:53","21:06","21:18","21:33","21:44",
      "21:59","22:17","22:29","22:43","23:04","23:18","23:32","23:39","23:50"
    ];

    // 八戸ノ里 上り (時刻データは変更なし)
    const weekdayHachino = [
      { time:"05:07", dest:"　尼崎　" },
      { time:"05:21", dest:"大阪難波" },
      { time:"05:33", dest:"大阪難波" },
      { time:"05:49", dest:"大阪難波" },
      { time:"06:00", dest:"大阪難波" },
      { time:"06:12", dest:"大阪難波" },
      { time:"06:24", dest:"大阪難波" },
      { time:"06:37", dest:"大阪難波" },
      { time:"06:48", dest:"　尼崎　" },
      { time:"06:59", dest:"　尼崎　" },
      { time:"07:06", dest:"　尼崎　" },
      { time:"07:17", dest:"　尼崎　" },
      { time:"07:30", dest:"　尼崎　" },
      { time:"07:40", dest:"　尼崎　" },
      { time:"07:50", dest:"　尼崎　" },
      { time:"08:02", dest:"　尼崎　" },
      { time:"08:10", dest:"大阪難波" },
      { time:"08:18", dest:"　尼崎　" },
      { time:"08:30", dest:"　尼崎　" },
      { time:"08:41", dest:"　尼崎　" },
      { time:"08:53", dest:"　尼崎　" },
      { time:"09:04", dest:"大阪難波" },
      { time:"09:18", dest:"　尼崎　" },
      { time:"09:26", dest:"　尼崎　" },
      { time:"09:41", dest:"　尼崎　" },
      { time:"09:54", dest:"　尼崎　" },
      { time:"10:02", dest:"大阪難波" },
      { time:"10:13", dest:"大阪難波" },
      { time:"10:20", dest:"大阪難波" },
      { time:"10:33", dest:"　尼崎　" },
      { time:"10:40", dest:"大阪難波" },
      { time:"10:53", dest:"　尼崎　" },
      { time:"11:00", dest:"大阪難波" },
      { time:"11:13", dest:"　尼崎　" },
      { time:"11:20", dest:"大阪難波" },
      { time:"11:33", dest:"　尼崎　" },
      { time:"11:40", dest:"大阪難波" },
      { time:"11:53", dest:"　尼崎　" },
      { time:"12:00", dest:"大阪難波" },
      { time:"12:13", dest:"　尼崎　" },
      { time:"12:20", dest:"大阪難波" },
      { time:"12:33", dest:"　尼崎　" },
      { time:"12:40", dest:"大阪難波" },
      { time:"12:53", dest:"　尼崎　" },
      { time:"13:00", dest:"大阪難波" },
      { time:"13:13", dest:"　尼崎　" },
      { time:"13:20", dest:"大阪難波" },
      { time:"13:33", dest:"　尼崎　" },
      { time:"13:40", dest:"大阪難波" },
      { time:"13:53", dest:"　尼崎　" },
      { time:"14:00", dest:"大阪難波" },
      { time:"14:13", dest:"　尼崎　" },
      { time:"14:20", dest:"大阪難波" },
      { time:"14:33", dest:"　尼崎　" },
      { time:"14:40", dest:"大阪難波" },
      { time:"14:53", dest:"　尼崎　" },
      { time:"15:00", dest:"大阪難波" },
      { time:"15:13", dest:"　尼崎　" },
      { time:"15:20", dest:"　尼崎　" },
      { time:"15:33", dest:"　尼崎　" },
      { time:"15:40", dest:"　尼崎　" },
      { time:"15:53", dest:"　尼崎　" },
      { time:"16:00", dest:"　尼崎　" },
      { time:"16:13", dest:"　尼崎　" },
      { time:"16:20", dest:"　尼崎　" },
      { time:"16:31", dest:"　尼崎　" },
      { time:"16:40", dest:"　尼崎　" },
      { time:"16:53", dest:"　尼崎　" },
      { time:"17:03", dest:"　尼崎　" },
      { time:"17:12", dest:"　尼崎　" },
      { time:"17:21", dest:"　尼崎　" },
      { time:"17:32", dest:"　尼崎　" },
      { time:"17:42", dest:"　尼崎　" },
      { time:"17:52", dest:"　尼崎　" },
      { time:"18:01", dest:"　尼崎　" },
      { time:"18:12", dest:"　尼崎　" },
      { time:"18:22", dest:"　尼崎　" },
      { time:"18:32", dest:"　尼崎　" },
      { time:"18:42", dest:"　尼崎　" },
      { time:"18:52", dest:"　尼崎　" },
      { time:"19:02", dest:"　尼崎　" },
      { time:"19:12", dest:"　尼崎　" },
      { time:"19:22", dest:"　尼崎　" },
      { time:"19:32", dest:"　尼崎　" },
      { time:"19:42", dest:"　尼崎　" },
      { time:"19:46", dest:"大阪難波" },
      { time:"19:54", dest:"　尼崎　" },
      { time:"20:05", dest:"　尼崎　" },
      { time:"20:15", dest:"　尼崎　" },
      { time:"20:28", dest:"　尼崎　" },
      { time:"20:40", dest:"　尼崎　" },
      { time:"20:53", dest:"　尼崎　" },
      { time:"21:01", dest:"　尼崎　" },
      { time:"21:12", dest:"　尼崎　" },
      { time:"21:24", dest:"　尼崎　" },
      { time:"21:36", dest:"　尼崎　" },
      { time:"21:48", dest:"　尼崎　" },
      { time:"21:59", dest:"大阪難波" },
      { time:"22:14", dest:"　尼崎　" },
      { time:"22:28", dest:"　尼崎　" },
      { time:"22:36", dest:"大阪難波" },
      { time:"22:48", dest:"大阪難波" },
      { time:"22:58", dest:"　尼崎　" },
      { time:"23:12", dest:"　尼崎　" },
      { time:"23:27", dest:"　尼崎　" },
      { time:"23:37", dest:"　尼崎　" },
      { time:"23:49", dest:"大阪難波" }
    ];
    const holidayHachino = [
     { time:"05:07", dest:"　尼崎　" },
      { time:"05:21", dest:"大阪難波" },
      { time:"05:33", dest:"大阪難波" },
      { time:"05:51", dest:"大阪難波" },
      { time:"06:08", dest:"大阪難波" },
      { time:"06:20", dest:"大阪難波" },
      { time:"06:34", dest:"大阪難波" },
      { time:"06:46", dest:"大阪難波" },
      { time:"07:00", dest:"大阪難波" },
      { time:"07:13", dest:"大阪難波" },
      { time:"07:29", dest:"大阪難波" },
      { time:"07:40", dest:"大阪難波" },
      { time:"07:50", dest:"大阪難波" },
      { time:"08:00", dest:"大阪難波" },
      { time:"08:09", dest:"大阪難波" },
      { time:"08:21", dest:"大阪難波" },
      { time:"08:30", dest:"大阪難波" },
      { time:"08:41", dest:"大阪難波" },
      { time:"08:53", dest:"　尼崎　" },
      { time:"09:01", dest:"大阪難波" },
      { time:"09:13", dest:"　尼崎　" },
      { time:"09:20", dest:"大阪難波" },
      { time:"09:32", dest:"　尼崎　" },
      { time:"09:41", dest:"大阪難波" },
      { time:"09:53", dest:"　尼崎　" },
      { time:"10:00", dest:"大阪難波" },
      { time:"10:13", dest:"　尼崎　" },
      { time:"10:18", dest:"大阪難波" },
      { time:"10:33", dest:"　尼崎　" },
      { time:"10:40", dest:"大阪難波" },
      { time:"10:53", dest:"　尼崎　" },
      { time:"11:00", dest:"大阪難波" },
      { time:"11:13", dest:"　尼崎　" },
      { time:"11:18", dest:"大阪難波" },
      { time:"11:33", dest:"　尼崎　" },
      { time:"11:40", dest:"大阪難波" },
      { time:"11:53", dest:"　尼崎　" },
      { time:"12:00", dest:"大阪難波" },
      { time:"12:13", dest:"　尼崎　" },
      { time:"12:18", dest:"大阪難波" },
      { time:"12:33", dest:"　尼崎　" },
      { time:"12:40", dest:"大阪難波" },
      { time:"12:53", dest:"　尼崎　" },
      { time:"13:00", dest:"大阪難波" },
      { time:"13:13", dest:"　尼崎　" },
      { time:"13:18", dest:"大阪難波" },
      { time:"13:33", dest:"　尼崎　" },
      { time:"13:40", dest:"大阪難波" },
      { time:"13:53", dest:"　尼崎　" },
      { time:"14:00", dest:"大阪難波" },
      { time:"14:13", dest:"　尼崎　" },
      { time:"14:18", dest:"大阪難波" },
      { time:"14:33", dest:"　尼崎　" },
      { time:"14:40", dest:"大阪難波" },
      { time:"14:53", dest:"　尼崎　" },
      { time:"15:00", dest:"大阪難波" },
      { time:"15:13", dest:"　尼崎　" },
      { time:"15:18", dest:"大阪難波" },
      { time:"15:33", dest:"　尼崎　" },
      { time:"15:40", dest:"大阪難波" },
      { time:"15:53", dest:"　尼崎　" },
      { time:"16:00", dest:"大阪難波" },
      { time:"16:13", dest:"　尼崎　" },
      { time:"16:18", dest:"大阪難波" },
      { time:"16:33", dest:"　尼崎　" },
      { time:"16:40", dest:"大阪難波" },
      { time:"16:53", dest:"　尼崎　" },
      { time:"17:00", dest:"大阪難波" },
      { time:"17:13", dest:"　尼崎　" },
      { time:"17:18", dest:"大阪難波" },
      { time:"17:33", dest:"　尼崎　" },
      { time:"17:40", dest:"大阪難波" },
      { time:"17:53", dest:"　尼崎　" },
      { time:"18:00", dest:"大阪難波" },
      { time:"18:13", dest:"　尼崎　" },
      { time:"18:21", dest:"　尼崎　" },
      { time:"18:33", dest:"　尼崎　" },
      { time:"18:47", dest:"　尼崎　" },
      { time:"18:57", dest:"　尼崎　" },
      { time:"19:12", dest:"　尼崎　" },
      { time:"19:24", dest:"　尼崎　" },
      { time:"19:36", dest:"　尼崎　" },
      { time:"19:49", dest:"　尼崎　" },
      { time:"20:05", dest:"　尼崎　" },
      { time:"20:17", dest:"　尼崎　" },
      { time:"20:25", dest:"　尼崎　" },
      { time:"20:36", dest:"　尼崎　" },
      { time:"20:48", dest:"　尼崎　" },
      { time:"20:59", dest:"　尼崎　" },
      { time:"21:12", dest:"　尼崎　" },
      { time:"21:28", dest:"大阪難波" },
      { time:"21:42", dest:"大阪難波" },
      { time:"21:57", dest:"　尼崎　" },
      { time:"22:09", dest:"大阪難波" },
      { time:"22:20", dest:"大阪難波" },
      { time:"22:34", dest:"　尼崎　" },
      { time:"22:47", dest:"　尼崎　" },
      { time:"22:58", dest:"　尼崎　" },
      { time:"23:12", dest:"　尼崎　" },
      { time:"23:27", dest:"　尼崎　" },
      { time:"23:38", dest:"　尼崎　" },
      { time:"23:49", dest:"大阪難波" },
    ];

    // 八戸ノ里 下り (時刻データは変更なし)
    const weekdayHachinoDown = [
      { "time":"05:29", "dest":"大和西大寺" },
      { "time":"05:29", "dest":"　東花園　" },
      { "time":"06:03", "dest":"　東花園　" },
      { "time":"06:17", "dest":"　東花園　" },
      { "time":"06:34", "dest":"　東生駒　" },
      { "time":"06:50", "dest":"　 奈良 　" },
      { "time":"07:03", "dest":"大和西大寺" },
      { "time":"07:11", "dest":"   奈良   " },
      { "time":"07:25", "dest":"   奈良 　" },
      { "time":"07:39", "dest":"大和西大寺" },
      { "time":"07:49", "dest":"大和西大寺" },
      { "time":"07:52", "dest":"  東花園  " },
      { "time":"07:58", "dest":"大和西大寺" },
      { "time":"08:06", "dest":"  東花園  " },
      { "time":"08:13", "dest":"大和西大寺" },
      { "time":"08:19", "dest":"  東花園  " },
      { "time":"08:25", "dest":"  東花園  " },
      { "time":"08:36", "dest":"   奈良   " },
      { "time":"08:49", "dest":"   奈良   " },
      { "time":"08:59", "dest":"  東花園  " },
      { "time":"09:13", "dest":"  東花園  " },
      { "time":"09:20", "dest":"  東花園  " },
      { "time":"09:26", "dest":"  東花園  " },
      { "time":"09:38", "dest":"   奈良   " },
      { "time":"09:49", "dest":"大和西大寺" },
      { "time":"10:01", "dest":"  東花園  " },
      { "time":"10:15", "dest":"大和西大寺" },
      { "time":"10:21", "dest":"  東花園  " },
      { "time":"10:35", "dest":"大和西大寺" },
      { "time":"10:41", "dest":"  東花園  " },
      { "time":"10:55", "dest":"   奈良   " },
      { "time":"11:01", "dest":"  東花園  " },
      { "time":"11:15", "dest":"大和西大寺" },
      { "time":"11:21", "dest":"  東花園  " },
      { "time":"11:35", "dest":"大和西大寺" },
      { "time":"11:41", "dest":"  東花園  " },
      { "time":"11:55", "dest":"大和西大寺" },
      { "time":"12:01", "dest":"  東花園  " },
      { "time":"12:15", "dest":"大和西大寺" },
      { "time":"12:21", "dest":"  東花園  " },
      { "time":"12:35", "dest":"大和西大寺" },
      { "time":"12:41", "dest":"  東花園  " },
      { "time":"12:55", "dest":"大和西大寺" },
      { "time":"13:01", "dest":"  東花園  " },
      { "time":"13:15", "dest":"大和西大寺" },
      { "time":"13:21", "dest":"  東花園  " },
      { "time":"13:35", "dest":"   奈良   " },
      { "time":"13:41", "dest":"  東花園  " },
      { "time":"13:55", "dest":"大和西大寺" },
      { "time":"14:01", "dest":"  東花園  " },
      { "time":"14:15", "dest":"大和西大寺" },
      { "time":"14:21", "dest":"  東花園  " },
      { "time":"14:35", "dest":"   奈良   " },
      { "time":"14:41", "dest":"  東花園  " },
      { "time":"14:55", "dest":"大和西大寺" },
      { "time":"15:01", "dest":"  東花園  " },
      { "time":"15:15", "dest":"大和西大寺" },
      { "time":"15:21", "dest":"  東花園  " },
      { "time":"15:35", "dest":"大和西大寺" },
      { "time":"15:41", "dest":"　東花園　" },
      { "time":"15:55", "dest":"大和西大寺" },
      { "time":"16:01", "dest":"  東花園  " },
      { "time":"16:15", "dest":"   奈良   " },
      { "time":"16:21", "dest":"  東花園  " },
      { "time":"16:35", "dest":"大和西大寺" },
      { "time":"16:41", "dest":"  東花園  " },
      { "time":"16:57", "dest":"   石切   " },
      { "time":"17:06", "dest":"  東生駒  " },
      { "time":"17:10", "dest":"  東花園  " },
      { "time":"17:22", "dest":"大和西大寺" },
      { "time":"17:32", "dest":"  東生駒  " },
      { "time":"17:42", "dest":"   奈良   " },
      { "time":"17:52", "dest":"  東生駒  " },
      { "time":"18:02", "dest":"   奈良   " },
      { "time":"18:11", "dest":"  東生駒  " },
      { "time":"18:22", "dest":"   奈良   " },
      { "time":"18:32", "dest":"  東生駒  " },
      { "time":"18:42", "dest":"大和西大寺" },
      { "time":"18:52", "dest":"  東生駒  " },
      { "time":"19:03", "dest":"大和西大寺" },
      { "time":"19:11", "dest":"  東生駒  " },
      { "time":"19:22", "dest":"   奈良   " },
      { "time":"19:32", "dest":"  東生駒  " },
      { "time":"19:42", "dest":"   奈良   " },
      { "time":"19:52", "dest":"  東生駒  " },
      { "time":"20:02", "dest":"大和西大寺" },
      { "time":"20:10", "dest":"大和西大寺" },
      { "time":"20:22", "dest":"   奈良   " },
      { "time":"20:31", "dest":"　東花園　" },
      { "time":"20:45", "dest":"大和西大寺" },
      { "time":"21:00", "dest":"　東花園　" },
      { "time":"21:14", "dest":"大和西大寺" },
      { "time":"21:21", "dest":"　東花園　" },
      { "time":"21:35", "dest":"　東花園　" },
      { "time":"21:51", "dest":"   奈良   " },
      { "time":"22:04", "dest":"　東花園　" },
      { "time":"22:15", "dest":"　東花園　" },
      { "time":"22:29", "dest":"   奈良   " },
      { "time":"22:42", "dest":"大和西大寺" },
      { "time":"23:00", "dest":"　東花園　" },
      { "time":"23:16", "dest":"　東花園　" },
      { "time":"23:30", "dest":"　東花園　" },
      { "time":"23:44", "dest":"大和西大寺" },
      { "time":"00:05", "dest":"　東花園　" },
      { "time":"00:21", "dest":"　東花園　" }
    ];
    const holidayHachinoDown = [
      { "time":"05:29", "dest":"大和西大寺" },
      { "time":"05:49", "dest":"   奈良   " },
      { "time":"06:04", "dest":"大和西大寺" },
      { "time":"06:24", "dest":"  東花園  " },
      { "time":"06:38", "dest":"  東花園  " },
      { "time":"06:53", "dest":"  東花園  " },
      { "time":"07:07", "dest":"  東花園  " },
      { "time":"07:24", "dest":"大和西大寺" },
      { "time":"07:32", "dest":"  東花園  " },
      { "time":"07:44", "dest":"   奈良   " },
      { "time":"07:57", "dest":"  東花園  " },
      { "time":"08:12", "dest":"大和西大寺" },
      { "time":"08:24", "dest":"  東花園  " },
      { "time":"08:29", "dest":"  東花園  " },
      { "time":"08:39", "dest":"  東花園  " },
      { "time":"08:47", "dest":"大和西大寺" },
      { "time":"08:58", "dest":"大和西大寺" },
      { "time":"09:09", "dest":"  東花園  " },
      { "time":"09:20", "dest":"  東花園  " },
      { "time":"09:31", "dest":"大和西大寺" },
      { "time":"09:40", "dest":"  東花園  " },
      { "time":"09:54", "dest":"   奈良   " },
      { "time":"10:01", "dest":"  東花園  " },
      { "time":"10:15", "dest":"大和西大寺" },
      { "time":"10:21", "dest":"  東花園  " },
      { "time":"10:35", "dest":"   奈良   " },
      { "time":"10:41", "dest":"  東花園  " },
      { "time":"10:55", "dest":"大和西大寺" },
      { "time":"11:01", "dest":"  東花園  " },
      { "time":"11:15", "dest":"   奈良   " },
      { "time":"11:21", "dest":"  東花園  " },
      { "time":"11:35", "dest":"大和西大寺" },
      { "time":"11:41", "dest":"  東花園  " },
      { "time":"11:55", "dest":"大和西大寺" },
      { "time":"12:01", "dest":"  東花園  " },
      { "time":"12:15", "dest":"   奈良   " },
      { "time":"12:21", "dest":"  東花園  " },
      { "time":"12:35", "dest":"大和西大寺" },
      { "time":"12:41", "dest":"  東花園  " },
      { "time":"12:55", "dest":"   奈良   " },
      { "time":"13:01", "dest":"  東花園  " },
      { "time":"13:15", "dest":"大和西大寺" },
      { "time":"13:21", "dest":"  東花園  " },
      { "time":"13:35", "dest":"大和西大寺" },
      { "time":"13:41", "dest":"  東花園  " },
      { "time":"13:55", "dest":"大和西大寺" },
      { "time":"14:01", "dest":"  東花園  " },
      { "time":"14:15", "dest":"大和西大寺" },
      { "time":"14:21", "dest":"  東花園  " },
      { "time":"14:35", "dest":"大和西大寺" },
      { "time":"14:41", "dest":"  東花園  " },
      { "time":"14:55", "dest":"大和西大寺" },
      { "time":"15:01", "dest":"  東花園  " },
      { "time":"15:15", "dest":"大和西大寺" },
      { "time":"15:21", "dest":"  東花園  " },
      { "time":"15:35", "dest":"   奈良   " },
      { "time":"15:41", "dest":"  東花園  " },
      { "time":"15:55", "dest":"大和西大寺" },
      { "time":"16:01", "dest":"  東花園  " },
      { "time":"16:15", "dest":"   奈良   " },
      { "time":"16:21", "dest":"  東花園  " },
      { "time":"16:35", "dest":"   奈良   " },
      { "time":"16:41", "dest":"  東花園  " },
      { "time":"16:55", "dest":"大和西大寺" },
      { "time":"17:01", "dest":"  東花園  " },
      { "time":"17:15", "dest":"   奈良   " },
      { "time":"17:21", "dest":"  東花園  " },
      { "time":"17:35", "dest":"   奈良   " },
      { "time":"17:41", "dest":"  東花園  " },
      { "time":"17:55", "dest":"大和西大寺" },
      { "time":"18:01", "dest":"  東花園  " },
      { "time":"18:15", "dest":"大和西大寺" },
      { "time":"18:21", "dest":"  東花園  " },
      { "time":"18:35", "dest":"   奈良   " },
      { "time":"18:41", "dest":"  東花園  " },
      { "time":"18:55", "dest":"大和西大寺" },
      { "time":"19:01", "dest":"  東花園  " },
      { "time":"19:15", "dest":"   奈良   " },
      { "time":"19:21", "dest":"  東花園  " },
      { "time":"19:35", "dest":"  東花園  " },
      { "time":"19:41", "dest":"   奈良   " },
      { "time":"19:51", "dest":"  東花園  " },
      { "time":"20:03", "dest":"   奈良   " },
      { "time":"20:19", "dest":"  東花園  " },
      { "time":"20:35", "dest":"  東花園  " },
      { "time":"20:41", "dest":"大和西大寺" },
      { "time":"20:49", "dest":"  東花園  " },
      { "time":"21:03", "dest":"  東生駒  " },
      { "time":"21:17", "dest":"大和西大寺" },
      { "time":"21:29", "dest":"  東花園  " },
      { "time":"21:46", "dest":"  東花園  " },
      { "time":"21:58", "dest":"   奈良   " },
      { "time":"22:14", "dest":"  東花園  " },
      { "time":"22:28", "dest":"  東花園  " },
      { "time":"22:41", "dest":"  東花園  " },
      { "time":"22:55", "dest":"  東花園  " },
      { "time":"23:11", "dest":"   奈良   " },
      { "time":"23:28", "dest":"   奈良   " },
      { "time":"23:44", "dest":"大和西大寺" },
      { "time":"00:05", "dest":"  東花園  " },
      { "time":"00:21", "dest":"  東花園  " }
    ];
  </script>

  <script>
    function pad(n){ return n.toString().padStart(2,"0"); }
    function timeStringToDate(str, base){
      if(!str) return null;
      const [h,m]=str.split(":").map(Number);
      let d = new Date(base.getFullYear(), base.getMonth(), base.getDate(), h, m, 0);
      // 0時台の時刻が現在の時刻より前の場合、日付を翌日にする処理 (始発対応)
      if (h < 5 && d < base) {
          d.setDate(d.getDate() + 1);
      }
      return d;
    }

    function getUpcomingTimes(now, list){
      let upcoming = [];
      
      // 当日分の時刻をチェック
      for(let i=0;i<list.length;i++){
        let t = timeStringToDate(list[i].time || list[i], now);
        
        // 0時台の処理 (翌日扱い)
        if (t.getHours() < 5 && now.getHours() >= 5 && t < now) {
             t.setDate(t.getDate() + 1);
        } else if (t.getHours() >= 5 && t < now) {
            // 過ぎた時刻はスキップ
            continue;
        } else if (t.getHours() < 5 && now.getHours() < 5 && t < now) {
             // 0時台で、現在時刻も0-4時台なら、過ぎた時刻は翌日
             t.setDate(t.getDate() + 1);
        }


        if (t > now) {
            upcoming.push({ time: t, idx: i, data: list[i] });
        }
      }
      
      // 翌日分の始発をチェック（当日分の時刻リストの最初から）
      // 既に十分な列車があればスキップ
      if (upcoming.length < 2) {
          const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
          for (let i = 0; i < list.length && upcoming.length < 2; i++) {
              let t = timeStringToDate(list[i].time || list[i], tomorrow);
              
              // 5時より前の時刻（0時台など）は、次の日の時刻として扱う
              if(t.getHours() < 5 || t.getHours() >= 23){
                  t = timeStringToDate(list[i].time || list[i], tomorrow);
              }
              
              // 現在時刻が当日の夜遅く（例：23時台）で、翌日始発が必要な場合を考慮
              if(t > now && !upcoming.some(u => u.time.getTime() === t.getTime())) {
                upcoming.push({ time: t, idx: i, data: list[i] });
              }
          }
      }

      upcoming.sort((a, b) => a.time - b.time); // 時刻でソート

      return { 
        next: upcoming[0] ? upcoming[0].time : null, 
        nextData: upcoming[0] ? upcoming[0].data : null,
        after: upcoming[1] ? upcoming[1].time : null,
        afterData: upcoming[1] ? upcoming[1].data : null
      };
    }

    function updateCountdown(elem,time){
      const now=new Date();
      if(!time){ elem.textContent="--"; return; }
      const diff=Math.max(0,(time-now)/1000);
      const m=Math.floor(diff/60), s=Math.floor(diff%60);
      elem.textContent=`あと ${m} 分 ${s} 秒`;
    }

    function updateSection(prefix, list, now){
      const info=getUpcomingTimes(now,list);
      
      const nextTimeElem = document.getElementById(prefix+"NextTime");
      const nextDestElem = document.getElementById(prefix+"NextDestination");
      const nextCountdownElem = document.getElementById(prefix+"NextCountdown");
      
      const secondTimeElem = document.getElementById(prefix+"SecondTime");
      const secondDestElem = document.getElementById(prefix+"SecondDestination");
      const secondCountdownElem = document.getElementById(prefix+"SecondCountdown");

      // 先発の更新
      if(info.next){
        nextTimeElem.textContent=`${pad(info.next.getHours())}:${pad(info.next.getMinutes())}`;
        // ★修正: destがある場合、全角スペースを含むすべての空白を削除して表示
        const destText = info.nextData.dest ? info.nextData.dest.trim().replace(/\s/g, '') : "大阪上本町";
        nextDestElem.textContent = destText;
        updateCountdown(nextCountdownElem,info.next);
      } else {
        nextTimeElem.textContent="--:--";
        nextCountdownElem.textContent="--";
        if(nextDestElem.textContent === "--") nextDestElem.textContent = "大阪上本町";
      }
      
      // 次発の更新
      if(info.after){
        secondTimeElem.textContent=`${pad(info.after.getHours())}:${pad(info.after.getMinutes())}`;
        const destText = info.afterData.dest ? info.afterData.dest.trim().replace(/\s/g, '') : "大阪上本町";
        secondDestElem.textContent = destText;
        updateCountdown(secondCountdownElem,info.after);
      } else {
        secondTimeElem.textContent="--:--";
        secondCountdownElem.textContent="--";
        if(secondDestElem.textContent === "--") secondDestElem.textContent = "大阪上本町";
      }
    }

    function updateAll(){
      const now=new Date();
      // 現在時刻の文字と時刻部分を分けて表示
      document.getElementById("currentTime").textContent=`${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`; 
      const isHoliday=(now.getDay()===0 || now.getDay()===6);
      document.getElementById("dayLabel").textContent = isHoliday ? "休日ダイヤ" : "平日ダイヤ";

      // 長瀬上り：destフィールドがない時刻リストを、処理用にdestを補完したリストに変換
      updateSection("nagase", isHoliday?holidayTimesNagase.map(t => ({time:t, dest:"大阪上本町"})):weekdayTimesNagase.map(t => ({time:t, dest:"大阪上本町"})), now);
      // 八戸ノ里上り・下り：destフィールドがあるオブジェクトのリストを使用
      updateSection("hachino", isHoliday?holidayHachino:weekdayHachino, now);
      updateSection("hachinoDown", isHoliday?holidayHachinoDown:weekdayHachinoDown, now);
    }

    setInterval(updateAll,1000);
    updateAll();
  </script>
</body>
</html>
